#!/usr/bin/env bash
source $(cli loader)

help() {
cat << EOF
Command
    ${CLI_PATH}
    
Summary
    Find set of transitive imports for a set of root libraries.

Arguments
    --tree -t        [Flag] : Indent output.
    --                      : List of imports.

Global Arguments
    --help -h        [Flag] : Show this message and exit.
    --self-test      [Flag] : Runs a self test.

Examples
    Emit the unique sorted imports of 'cli dsl'
        cli imports -c "cli dsl"
EOF
}

recurse() (
    local -a CLI_LOADER_IMPORTS

    while (( $# > 0 )); do
        echo "${prefix}$1"

        # capture transitivie imports by executing 
        # the source generated by the import
        CLI_LOADER_IMPORTS=()
        $1 ---exports \
            | source /dev/stdin

        prefix="${prefix}${indent}" recurse "${CLI_LOADER_IMPORTS[@]}"

        shift
    done 
)

main() {
    local prefix=
    local indent=

    if ${arg_tree}; then
        indent='  '
    fi

    recurse "$@"
}

cli::load "$@"