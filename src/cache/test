#!/usr/bin/env CLI_NAME=cli bash-cli-part

help() {
    cat << EOF
Command
    ${CLI_COMMAND[@]}

Summary
    Test if a file exists and is older than another file.

Description
    Argument $1 is the path to the generated file.

    Argument $2 is the source from which the generated file depends.
    
    Succeeds if the generated file exists and is older than the source file,
    otherwise false.
EOF
}

cli::meta::declare() {
    cli::meta::allow_positional
}

::cli::cache::test::inline() {
    local CACHE="$1"
    local SOURCE="$2"

    [[ -f "${CACHE}" ]] && [[ "${SOURCE}" -ot "${CACHE}" ]]
}

self_test() {
    local OLD
    cli::temp::file OLD
    
    local NEW
    cli::temp::file NEW

    ! ::cli::cache::test::inline 'no_cache_file' "${OLD}" || cli::assert
    ! ::cli::cache::test::inline "${OLD}" "${OLD}" || cli::assert
    ! ::cli::cache::test::inline "${OLD}" "${NEW}" || cli::assert
    ::cli::cache::test::inline "${NEW}" "${OLD}" || cli::assert
}
