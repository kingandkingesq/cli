#!/usr/bin/env bash
source $(cli loader)

help() {
    cat << EOF
Command
    ${CLI_COMMAND}

Global Arguments
    --help -h        [Flag] : Show this message and exit.
    --self-test      [Flag] : Runs a self test.
EOF
}

declare CLI_REGEX_NAME="^[a-z.][a-z0-9-]*$"
declare CLI_REGEX_FLAGS="^[a-z]+$"
declare CLI_REGEX_BASH_NAME="^[a-z_][a-z0-9_]*$"
declare CLI_REGEX_UNIX_NAME="^[a-z.][a-z0-9_]*$"

declare CLI_REGEX_VARIABLE_NAME="^[a-z][a-z0-9_]*$"
declare CLI_REGEX_STRUCT_NAME=${CLI_REGEX_VARIABLE_NAME}
declare CLI_REGEX_STRUCT_FIELD_NAME=${CLI_REGEX_VARIABLE_NAME}
declare CLI_REGEX_TYPE_NAME="^(map_of[[:space:]])*[a-z][a-z0-9_]*$"
declare CLI_REGEX_GLOBAL_NAME="^[A-Z][A-Z0-9_]*$"

declare CLI_STRUCT_DEFAULT_NAME=struct
declare CLI_STRUCT_DEFAULT_VARIABLE=STRUCT

declare CLI_GLOBAL_ARG_HELP_FLAG="--help -h        [Flag] : Show this message and exit."
declare CLI_GLOBAL_ARG_SELF_TEST_FLAG="--self-test      [Flag] : Runs a self test."

declare -A CLI_TYPE_CLI_ARGS=( \
    [path]="array" \
    [named]="map" \
    [positional]="array" \
)

declare -A CLI_TYPE_CLI_META=( \
    [require]="map" \
    [default]="map" \
    [regex]="map" \
    [positional]="boolean" \
    [implicit_value]="map" \
    [alias]="map" \
    [allow]="map_of map" \
)

declare -A CLI_TYPE_CLI_META_TABLES=(
    [require]="map_of map" \
    [default]="map_of map" \
    [regex]="map_of map" \
    [positional]="map_of boolean" \
    [implicit_value]="map_of map" \
    [alias]="map_of map" \
    [allow]="map_of map_of map" \
)

export() {
    {
        declare -p CLI_REGEX_NAME
        declare -p CLI_REGEX_FLAGS
        declare -p CLI_REGEX_BASH_NAME
        declare -p CLI_REGEX_UNIX_NAME

        declare -p CLI_REGEX_VARIABLE_NAME
        declare -p CLI_REGEX_STRUCT_NAME
        declare -p CLI_REGEX_STRUCT_FIELD_NAME
        declare -p CLI_REGEX_TYPE_NAME
        declare -p CLI_REGEX_GLOBAL_NAME

        declare -p CLI_STRUCT_DEFAULT_NAME
        declare -p CLI_STRUCT_DEFAULT_VARIABLE

        declare -p CLI_GLOBAL_ARG_HELP_FLAG
        declare -p CLI_GLOBAL_ARG_SELF_TEST_FLAG

        declare -p CLI_TYPE_CLI_ARGS
        declare -p CLI_TYPE_CLI_META
        declare -p CLI_TYPE_CLI_META_TABLES

    } | sed 's/^declare/declare -g/'
}

cli::main "$@"